# ProjectVisualNovel (Fall 2016 - Present)

##Overview
Built on top of a previously started project, https://github.com/wizered67/fencing-magician, the goal of this project is to recreate many of the elements common in **visual novels** in a [LibGDX] (https://libgdx.badlogicgames.com/) game. Visual novels are a type of video game that feature little gameplay and instead are made mostly of dialogue, with most interaction being in the form of making choices that influence the story in some way. Visual novels are less common for American gamers, but are extremely popular in Japan. This project was inspired by visual novels such as *Ace Attorney* and *Dangan Ronpa* and some of the ideas used in structuring the conversation files were based on *Ren'PY*, a Python engine for making visual novels. 

I chose to make this project instead of using something like Ren'Py for several reasons. Writing the command interpreter myself allows me to have much more control and allows me to implement commands however I feel is most convenient. Commands that would be inconvenient or impossible in Ren'Py can be implemented more easily. Additionally, writing this on top of LibGDX means that I can add any other gameplay I want in addition to the dialogue system. As such, extracting code from this project would allow me to make dialouge systems for any type of game, not just visual novels. Ren'Py is great for visual novels, but doesn't necessarily have functionality for other types of games. And perhaps most importantly, I thought it would be good experience to try doing something like this myself. There's little point in reinventing the wheel, but learning to make a better wheel is still useful.

##Demonstration
*Note: Graphics are placeholder and not mine. They are just for demonstration purposes.*
![gif](https://dl.dropboxusercontent.com/u/25507891/visualnovel3test.gif)

The file containing the conversation used in the example can be seen [here] (https://github.com/wizered67/ProjectVisualNovel/blob/master/android/assets/Conversations/demonstration.conv)

## How it works
Almost all of the code used for the visual novel system can be found in the [GUI package] (https://github.com/wizered67/ProjectVisualNovel/tree/master/core/src/com/wizered67/game/GUI). Many of the terms below are simply terms I created to refer to things in the dialogue system. Other visual novel systems may refer to them by other names.

The smallest component of dialogue is a [command] (https://github.com/wizered67/ProjectVisualNovel/blob/master/core/src/com/wizered67/game/GUI/Conversations/Commands/ConversationCommand.java). Each command makes some change to current status of the game. These changes can be things such as [adding a new character] (https://github.com/wizered67/ProjectVisualNovel/blob/master/core/src/com/wizered67/game/GUI/Conversations/Commands/CharacterAddCommand.java) to the screen, [displaying a sequence of text] (https://github.com/wizered67/ProjectVisualNovel/blob/master/core/src/com/wizered67/game/GUI/Conversations/Commands/MessageCommand.java), or playing a [sound effect] (https://github.com/wizered67/ProjectVisualNovel/blob/master/core/src/com/wizered67/game/GUI/Conversations/Commands/PlaySoundCommand.java). There are a wide variety of commands already implemented and more are being added still. 

One of the most useful commands is the previously mentioned [message command] (https://github.com/wizered67/ProjectVisualNovel/blob/master/core/src/com/wizered67/game/GUI/Conversations/Commands/MessageCommand.java). Since visual novels are made up of a lot of dialogue, it's really important to have a powerful message command. I've implemented the message command so that each message has a speaker, a series of "assignments", and a series of text. The speaker is used to set things like the name that shows above the dialogue box and the sound effect that plays when text is scrolling. The assignments are used to assign commands to text shortcuts. These text shortcuts can then be placed in the middle of the text to execute a command once the text scrolls to a certain point. This allows me to synchronize things like animations and sound effects with the scrolling of the textbox!

A named sequence of commands is a **branch**. The game will go through all commands in the current branch and execute them in order, sometimes stopping between commands to let the previous one finish, depending on what command it was. For example, playing a sound effect does not pause the execution of commands, but displaying a message does pause the execution of commands until the players clicks to confirm that they want to continue. Writing the code in a way that allowed commands to determine if they should pause execution has already proven to be extremely helpful. I can even implement commands that sometimes pause and sometimes don't, such as the set animation command which, depending on a variable, will either go straight to the next command or wait for the animation to finish. 

A group of branches is called a [conversation] (https://github.com/wizered67/ProjectVisualNovel/blob/master/core/src/com/wizered67/game/GUI/Conversations/Conversation.java). Unlike branches, conversations are not necessarily in order. Instead, branches are freely traveled between with the change branch command. An example where this would be useful is in the show choice command, which presents the player with several choices. Depending on which choice they make, a different command can be executed. Executing a change branch command lets the player go through a new series of dialogue depending on their choice. The player can even be returned to a branch they've already been through for looping dialogue. 

## Writing Conversations using XML
Because of the sheer number of commands that would be required to make a full visual novel, it has always been a priority to make it convenient and fast to write conversations. After some contemplation, I settled on using **XML** files to write conversations. This allows me to add tags that can have attributes and other elements within them. These tags are then converted to the corresponding commands in game by the [XML Loader] (https://github.com/wizered67/ProjectVisualNovel/blob/master/core/src/com/wizered67/game/GUI/Conversations/XmlIO/ConversationLoader.java). I have also written an [XML Writer] (https://github.com/wizered67/ProjectVisualNovel/blob/master/core/src/com/wizered67/game/GUI/Conversations/XmlIO/ConversationWriter.java) that converts in game command objects to XML and outputs it, although this hasn't seen much use yet.

I have taken several steps to make writing XML conversations as fast and error free as possible. IntelliJ, my IDE of choice, has really helped me with this. For example, I have specified in the IntelliJ settings a custom template for *.conv* files. By choosing the **New -> Conversation** choice when creating a file, it automatically creates an XML file that is setup for editing conversations. I also wanted to utilize IntelliJ's autocompletion and XML validation, so I looked into XML Schemas and was able to write one myself. The [Conversation Schema] (https://github.com/wizered67/ProjectVisualNovel/blob/master/core/src/com/wizered67/game/GUI/Conversations/XmlIO/ConversationSchema.xsd) I wrote makes it so IntelliJ automatically gives me autocomplete options for attributes for my custom tags. Additionally, it does some validation to ensure that there aren't errors in the XML formatting or missing attributes. I plan to later write a more extensive error checker in Java that checks that all XML files don't cause problems in game, such as referring to branches that were never created. An example .conv XML file, the one used in the above demonstration, can be seen [here] (https://github.com/wizered67/ProjectVisualNovel/blob/master/android/assets/Conversations/demonstration.conv). Additionally, some documentation on using the XML tags can be seen [here] (https://github.com/wizered67/ProjectVisualNovel/blob/master/core/src/com/wizered67/game/GUI/Conversations/XmlIO/XML%20Documentation.xml).

